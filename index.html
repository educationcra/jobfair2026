<!doctype html>
<html lang="th" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRA Job Fair & Education 2026 - Registration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS เดิมของคุณอาจารย์คงไว้ให้ครบถ้วน */
        body { box-sizing: border-box; font-family: 'Sarabun', sans-serif; }
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.3); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08); }
        .option-card { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; border: 2px solid transparent; background: white; position: relative; }
        .option-card.selected { border-color: #8b5cf6; background: linear-gradient(135deg, rgba(139, 92, 246, 0.08) 0%, rgba(236, 72, 153, 0.08) 100%); transform: translateY(-4px); }
        .check-indicator { position: absolute; top: 12px; right: 12px; width: 28px; height: 28px; background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; opacity: 0; transform: scale(0); transition: all 0.3s; }
        .option-card.selected .check-indicator { opacity: 1; transform: scale(1); }
        .btn-primary { background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%); transition: all 0.3s; }
        .progress-container { position: relative; display: flex; justify-content: space-between; align-items: center; max-width: 450px; margin: 0 auto; }
        .progress-line { position: absolute; top: 50%; left: 0; right: 0; height: 3px; background: #e5e7eb; transform: translateY(-50%); z-index: 0; }
        .progress-line-fill { height: 100%; background: linear-gradient(90deg, #8b5cf6 0%, #ec4899 100%); transition: width 0.5s; width: 0%; }
        .progress-step { width: 50px; height: 50px; border-radius: 50%; background: white; border: 3px solid #e5e7eb; display: flex; align-items: center; justify-content: center; font-weight: 600; position: relative; z-index: 1; }
        .progress-step.active { background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%); color: white; border-color: #8b5cf6; transform: scale(1.15); }
        .progress-step.completed { background: #6366f1; color: white; border-color: #6366f1; }
        .input-field { border: 2px solid #e5e7eb; transition: 0.3s; }
        .input-field:focus { border-color: #8b5cf6; outline: none; }
        .spinner { border: 3px solid rgba(255,255,255,.3); border-top: 3px solid white; border-radius: 50%; width: 20px; height: 20px; animation: spin .8s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .hidden { display: none; }
    </style>
</head>
<body class="h-full">
    <main class="h-full w-full overflow-auto py-12" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);">
        <div class="max-w-5xl mx-auto px-4">
            <header class="text-center mb-12">
                <h1 class="text-4xl sm:text-5xl font-bold text-yellow-400 mb-4">CRA Job Fair & Education 2026</h1>
                <p class="text-white text-xl">แบบฟอร์มลงทะเบียนผู้ประกอบการออกบูธ</p>
            </header>

            <div id="progressBar" class="mb-12 hidden">
                <div class="progress-container">
                    <div class="progress-line"><div id="progressLineFill" class="progress-line-fill"></div></div>
                    <div class="progress-step" data-step="1">1</div>
                    <div class="progress-step" data-step="2">2</div>
                    <div class="progress-step" data-step="3">3</div>
                </div>
            </div>

            <div class="glass-card rounded-3xl p-8 sm:p-12">
                <form id="registrationForm">
                    <section id="section1" class="section-content">
                        <h2 class="text-2xl font-bold mb-8">1. ความประสงค์เข้าร่วมงาน</h2>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-10">
                            <div class="option-card rounded-2xl p-6" data-interest="yes">
                                <div class="check-indicator">✓</div>
                                <span class="font-semibold text-gray-800">ต้องการเข้าร่วมออกบูธ</span>
                            </div>
                            <div class="option-card rounded-2xl p-6" data-interest="no">
                                <div class="check-indicator">✓</div>
                                <span class="font-semibold text-gray-800">ยังไม่สะดวกเข้าร่วม</span>
                            </div>
                        </div>

                        <div id="declineSection" class="hidden">
                            <input type="text" id="declineCompanyName" class="input-field w-full p-4 rounded-xl mb-4" placeholder="ชื่อบริษัท *">
                            <textarea id="declineReason" class="input-field w-full p-4 rounded-xl mb-6" placeholder="เหตุผลที่ไม่สะดวก"></textarea>
                            <button type="button" onclick="submitToAPI('decline')" class="btn-primary w-full text-white py-4 rounded-xl font-bold flex items-center justify-center">
                                <span>ส่งข้อมูล</span>
                                <div id="declineSpinner" class="spinner ml-3 hidden"></div>
                            </button>
                        </div>

                        <div id="participationArea" class="hidden">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                                <div class="option-card p-4 rounded-xl text-center" data-type="new">บริษัทใหม่</div>
                                <div class="option-card p-4 rounded-xl text-center" data-type="returning">บริษัทเดิม</div>
                                <div class="option-card p-4 rounded-xl text-center" data-type="education">การศึกษา/สนับสนุน</div>
                            </div>
                            <div id="dynamicFields" class="space-y-4">
                                </div>
                            <div class="flex justify-end mt-8">
                                <button type="button" id="btnNext1" onclick="showSection(2)" class="btn-primary text-white px-10 py-4 rounded-xl font-bold">ถัดไป</button>
                            </div>
                        </div>
                    </section>

                    <section id="section2" class="section-content hidden">
                        <h2 class="text-2xl font-bold mb-8">2. ข้อมูลผู้ประสานงาน</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <select id="titlePrefix" class="input-field p-4 rounded-xl bg-white"><option value="นาย">นาย</option><option value="นาง">นาง</option><option value="นางสาว">นางสาว</option></select>
                            <input type="text" id="firstName" class="input-field p-4 rounded-xl" placeholder="ชื่อ *">
                            <input type="text" id="lastName" class="input-field p-4 rounded-xl" placeholder="นามสกุล *">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <input type="text" id="position" class="input-field p-4 rounded-xl" placeholder="ตำแหน่ง *">
                            <input type="text" id="lineId" class="input-field p-4 rounded-xl" placeholder="Line ID *">
                        </div>
                        <input type="email" id="email" class="input-field w-full p-4 rounded-xl mb-4" placeholder="อีเมล *">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="tel" id="phone" class="input-field p-4 rounded-xl" placeholder="เบอร์โทร *">
                            <input type="text" id="phoneExt" class="input-field p-4 rounded-xl" placeholder="ต่อ">
                        </div>
                        <div class="flex justify-between mt-8">
                            <button type="button" onclick="showSection(1)" class="text-gray-500 font-bold">ย้อนกลับ</button>
                            <button type="button" onclick="showSection(3)" class="btn-primary text-white px-10 py-4 rounded-xl font-bold">ถัดไป</button>
                        </div>
                    </section>

                    <section id="section3" class="section-content hidden">
                        <h2 class="text-2xl font-bold mb-8">3. รายละเอียดบูธ</h2>
                        <div class="mb-6">
                            <label class="block mb-2 font-bold">จำนวนเจ้าหน้าประจำบูธ (1-5 คน) *</label>
                            <input type="number" id="boothStaffCount" min="1" max="5" value="1" class="input-field w-full p-4 rounded-xl">
                        </div>
                        <div class="space-y-4 mb-8">
                            <label class="flex items-center gap-3"><input type="checkbox" id="requestLargerBooth"> ขอพื้นที่บูธเพิ่ม</label>
                            <label class="flex items-center gap-3"><input type="checkbox" id="requestOther"> อื่นๆ</label>
                            <textarea id="requestOtherDetail" class="input-field w-full p-4 rounded-xl hidden" placeholder="ระบุรายละเอียด..."></textarea>
                        </div>
                        <div class="mb-8 p-6 bg-purple-50 rounded-xl">
                            <p class="font-bold mb-4">นำเสนอบนเวที 3 นาทีหรือไม่ *</p>
                            <div class="flex gap-4">
                                <div class="option-card p-4 rounded-lg flex-1 text-center" data-presentation="yes">ประสงค์</div>
                                <div class="option-card p-4 rounded-lg flex-1 text-center" data-presentation="no">ไม่ประสงค์</div>
                            </div>
                        </div>
                        <label class="flex items-start gap-3 mb-8"><input type="checkbox" id="consent" required> ยินยอมให้ใช้ข้อมูลเพื่อการจัดงาน *</label>
                        <div class="flex justify-between">
                            <button type="button" onclick="showSection(2)" class="text-gray-500 font-bold">ย้อนกลับ</button>
                            <button type="button" onclick="submitToAPI('full')" class="btn-primary text-white px-10 py-4 rounded-xl font-bold flex items-center">
                                <span>ส่งข้อมูลลงทะเบียน</span>
                                <div id="submitSpinner" class="spinner ml-3 hidden"></div>
                            </button>
                        </div>
                    </section>
                </form>
            </div>

            <div id="thankYouMessage" class="hidden glass-card rounded-3xl p-12 text-center shadow-2xl">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">ลงทะเบียนสำเร็จ!</h2>
                <p class="text-gray-600 mb-8">ขอบคุณสำหรับข้อมูล ทีมงานจะติดต่อกลับโดยเร็วที่สุด</p>
                <button onclick="location.reload()" class="btn-primary text-white px-10 py-4 rounded-xl font-bold">กลับหน้าแรก</button>
            </div>
        </div>
    </main>

    <script>
        // --- 1. การตั้งค่า URL (Web App URL จาก Google Script) ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzM5PdjRQCaOYf4adLiwZtnzL_doZV-iFkhPEU30fyflOXLw__uuzZLrHb_QlbBM1PH/exec";

        let formData = { booth_staff_count: 1 };
        let currentStep = 1;

        // --- 2. ฟังก์ชัน UI Logic ---
        document.querySelectorAll('[data-interest]').forEach(el => {
            el.onclick = () => {
                document.querySelectorAll('[data-interest]').forEach(x => x.classList.remove('selected'));
                el.classList.add('selected');
                formData.participation_interest = el.dataset.interest;
                const isYes = el.dataset.interest === 'yes';
                document.getElementById('participationArea').classList.toggle('hidden', !isYes);
                document.getElementById('declineSection').classList.toggle('hidden', isYes);
                document.getElementById('progressBar').classList.toggle('hidden', !isYes);
            };
        });

        document.querySelectorAll('[data-type]').forEach(el => {
            el.onclick = () => {
                document.querySelectorAll('[data-type]').forEach(x => x.classList.remove('selected'));
                el.classList.add('selected');
                formData.participation_type = el.dataset.type;
                updateDynamicFields(el.dataset.type);
            };
        });

        function updateDynamicFields(type) {
            const div = document.getElementById('dynamicFields');
            if (type === 'returning') {
                div.innerHTML = `<select id="returningCompany" class="input-field w-full p-4 rounded-xl bg-white">
                    <option value="">-- เลือกบริษัทเดิม --</option>
                    <option value="โรงพยาบาลจุฬาภรณ์">โรงพยาบาลจุฬาภรณ์</option>
                </select>`;
            } else {
                div.innerHTML = `<input type="text" id="companyName" class="input-field w-full p-4 rounded-xl" placeholder="ชื่อบริษัท/หน่วยงาน *">
                <input type="text" id="eventDate" class="input-field w-full p-4 rounded-xl mt-4" placeholder="วันที่เข้าร่วม (เช่น 12 ก.พ.)">`;
            }
        }

        function showSection(n) {
            document.querySelectorAll('.section-content').forEach(s => s.classList.add('hidden'));
            document.getElementById(`section${n}`).classList.remove('hidden');
            currentStep = n;
            document.getElementById('progressLineFill').style.width = `${(n-1)*50}%`;
            document.querySelectorAll('.progress-step').forEach(s => {
                const sNum = parseInt(s.dataset.step);
                s.classList.toggle('active', sNum === n);
                s.classList.toggle('completed', sNum < n);
            });
            window.scrollTo(0, 0);
        }

        document.getElementById('requestOther').onchange = (e) => {
            document.getElementById('requestOtherDetail').classList.toggle('hidden', !e.target.checked);
        };

        document.querySelectorAll('[data-presentation]').forEach(el => {
            el.onclick = () => {
                document.querySelectorAll('[data-presentation]').forEach(x => x.classList.remove('selected'));
                el.classList.add('selected');
                formData.interested_in_presentation = el.dataset.presentation === 'yes';
            };
        });

        // --- 3. ฟังก์ชันส่งข้อมูล (The Bridge) ---
        async function submitToAPI(mode) {
            const spinner = mode === 'decline' ? document.getElementById('declineSpinner') : document.getElementById('submitSpinner');
            const btn = event.target.closest('button');
            
            // รวบรวมข้อมูลเพิ่มเติม
            if (mode === 'decline') {
                formData.company_name = document.getElementById('declineCompanyName').value;
                formData.decline_reason = document.getElementById('declineReason').value;
            } else {
                // รวบรวมข้อมูลจากฟอร์ม
                formData.company_name = document.getElementById('companyName')?.value || document.getElementById('returningCompany')?.value;
                formData.title_prefix = document.getElementById('titlePrefix').value;
                formData.first_name = document.getElementById('firstName').value;
                formData.last_name = document.getElementById('lastName').value;
                formData.position = document.getElementById('position').value;
                formData.email = document.getElementById('email').value;
                formData.phone = document.getElementById('phone').value;
                formData.line_id = document.getElementById('lineId').value;
                formData.booth_staff_count = document.getElementById('boothStaffCount').value;
                formData.request_larger_booth = document.getElementById('requestLargerBooth').checked;
                formData.request_other = document.getElementById('requestOther').checked;
                formData.request_other_detail = document.getElementById('requestOtherDetail').value;
                formData.consent = document.getElementById('consent').checked;
            }

            if(!formData.company_name) return alert("กรุณาระบุชื่อบริษัท");

            btn.disabled = true;
            spinner.classList.remove('hidden');

            try {
                // ส่งข้อมูลไปยัง Google Apps Script
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                // สำเร็จ
                document.querySelector('.glass-card').classList.add('hidden');
                document.getElementById('thankYouMessage').classList.remove('hidden');
                window.scrollTo(0,0);

            } catch (error) {
                alert("เกิดข้อผิดพลาดในการส่งข้อมูล กรุณาลองใหม่");
                btn.disabled = false;
                spinner.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
